# JPetStore AI 반려동물 추천 시스템

## 프로젝트 개요

JPetStore에 AI 기반 반려동물 추천 시스템을 구현했습니다.
- **Local LLM (Ollama llama3.1:8b)**: 초기 추천 + 최종 추천
- **Gemini API**: 게임 시뮬레이션
- **Function Calling**: LLM이 실시간으로 DB 조회

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                        사용자 (웹 브라우저)                        │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                     Spring MVC + Stripes                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ InitialRecomm-  │  │ GameSimulation- │  │ FinalRecomm-    │  │
│  │ endationAction  │  │ ActionBean      │  │ endationAction  │  │
│  └────────┬────────┘  └────────┬────────┘  └────────┬────────┘  │
└───────────┼─────────────────────┼─────────────────────┼─────────┘
            │                     │                     │
            ▼                     ▼                     ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ OllamaRecomm-   │    │ GameSimulation- │    │ FinalRecomm-    │
│ endationService │    │ Service         │    │ endationService │
│                 │    │                 │    │                 │
│ [Ollama LLM]    │    │ [Gemini API]    │    │ [Ollama LLM]    │
│ + Function      │    │                 │    │                 │
│   Calling       │    │                 │    │                 │
└────────┬────────┘    └────────┬────────┘    └────────┬────────┘
         │                      │                      │
         ▼                      ▼                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                      MyBatis + HSQLDB                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────────────────┐          │
│  │ CATEGORY │  │ PRODUCT  │  │ PRODUCT_             │          │
│  │          │  │          │  │ CHARACTERISTICS      │          │
│  └──────────┘  └──────────┘  └──────────────────────┘          │
└─────────────────────────────────────────────────────────────────┘
```

---

## 추천 알고리즘 흐름

### 1단계: 초기 카테고리 추천 (Local LLM + Function Calling)

```
┌──────────────────────────────────────────────────────────────┐
│                    사용자 라이프스타일 정보                      │
│  - 나이: 28세                                                 │
│  - 직업: 소프트웨어 개발자                                      │
│  - 재택시간: 2-6시간                                          │
│  - 주거형태: 아파트                                            │
│  - 월 예산: 10-30만원                                         │
│  - 알레르기: 없음                                              │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│              Ollama LLM Agent (llama3.1:8b)                   │
│                                                              │
│  1. getCategories() 호출                                      │
│     → DB에서 5개 카테고리 조회 (FISH, DOGS, CATS, REPTILES,    │
│        BIRDS)                                                │
│                                                              │
│  2. getProductsByCategory() 호출 (각 카테고리별)               │
│     → 품종 목록 + 특성 데이터 조회                              │
│        - careLevel (관리 난이도)                               │
│        - spaceRequirement (필요 공간)                         │
│        - monthlyCost (월 비용)                                │
│        - allergyRisk (알레르기 위험)                           │
│        - noiseLevel (소음 수준)                               │
│        - activityLevel (활동량)                               │
│        - suitableForApartment (아파트 적합성)                  │
│        - suitableForBusy (바쁜 사람 적합성)                    │
│                                                              │
│  3. 라이프스타일 vs 품종 특성 분석                              │
│     → LLM이 자연어로 추론                                      │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│                    Top 5 카테고리 추천                         │
│                                                              │
│  1순위: CATS (85%) - "아파트에 적합하고 독립적..."              │
│  2순위: FISH (80%) - "좁은 공간에서도 키우기 쉽고..."           │
│  3순위: BIRDS (70%) - "..."                                   │
│  4순위: REPTILES (60%) - "..."                                │
│  5순위: DOGS (50%) - "..."                                    │
└──────────────────────────────────────────────────────────────┘
```

---

### 2단계: 게임 시뮬레이션 (Gemini API)

```
┌──────────────────────────────────────────────────────────────┐
│                  24시간 반려동물 돌봄 게임                      │
│                      (총 8턴, 턴당 3시간)                      │
└──────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐      ┌──────────────┐
│    1턴       │      │    2턴       │      │    ...       │
│   (7시)      │ ──▶  │   (10시)     │ ──▶  │              │
│              │      │              │      │              │
│ 상황 제시    │      │ 상황 제시    │      │              │
│ 3개 선택지   │      │ 3개 선택지   │      │              │
│              │      │              │      │              │
│ 건강: 100    │      │ 건강: 95     │      │              │
│ 행복: 50     │      │ 행복: 60     │      │              │
│ 비용: 0원    │      │ 비용: 5000원 │      │              │
└──────────────┘      └──────────────┘      └──────────────┘
                                                    │
                                                    ▼
                                          ┌──────────────┐
                                          │    8턴       │
                                          │   (28시)     │
                                          │              │
                                          │  게임 종료   │
                                          │              │
                                          │ 최종 건강: 85│
                                          │ 최종 행복: 90│
                                          │ 총 비용: 8만원│
                                          │              │
                                          │ 최종점수:    │
                                          │ (85+90)/2    │
                                          │   = 87점     │
                                          └──────────────┘

┌──────────────────────────────────────────────────────────────┐
│                     게임에서 파악하는 것                        │
│                                                              │
│  - 비용 관리 성향 (저렴한 선택 vs 비싼 선택)                    │
│  - 건강 vs 행복도 우선순위                                     │
│  - 돌봄 적극성 (이상적 선택 vs 애매한 선택 vs 게으름)            │
│  - 동물별 특성 이해도 (산책, 화장실, 먹이 등)                   │
└──────────────────────────────────────────────────────────────┘
```

---

### 3단계: 최종 품종 추천 (Local LLM)

```
┌──────────────────────────────────────────────────────────────┐
│                        입력 데이터                            │
│                                                              │
│  ┌─────────────────┐  ┌─────────────────┐                   │
│  │ 라이프스타일    │  │ 게임 결과       │                   │
│  │ 정보            │  │                 │                   │
│  │                 │  │ - 최종점수: 87  │                   │
│  │ - 나이: 28      │  │ - 건강도: 85    │                   │
│  │ - 직업: 개발자  │  │ - 행복도: 90    │                   │
│  │ - 재택: 2-6시간 │  │ - 비용: 8만원   │                   │
│  │ - 주거: 아파트  │  │                 │                   │
│  │ - 예산: 10-30만 │  │                 │                   │
│  └─────────────────┘  └─────────────────┘                   │
│                                                              │
│  ┌─────────────────────────────────────────┐                │
│  │ 카테고리 품종 목록 (예: CATS)            │                │
│  │                                         │                │
│  │ - FL-DSH-01: Manx (짧은 꼬리, 독립적)    │                │
│  │ - FL-DLH-02: Persian (긴털, 조용함)      │                │
│  │ - ...                                   │                │
│  └─────────────────────────────────────────┘                │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│              Ollama LLM 분석 (llama3.1:8b)                    │
│                                                              │
│  라이프스타일 분석:                                           │
│  "바쁜 개발자, 아파트 거주, 중간 예산"                         │
│                                                              │
│  게임 행동 분석:                                              │
│  "건강보다 행복도에 더 신경 씀, 비용 절약 성향"                 │
│                                                              │
│  최적 품종 매칭:                                              │
│  "독립적이고 관리가 쉬우며 애정 표현이 풍부한 품종"             │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│                      최종 추천 결과                           │
│                                                              │
│  추천 품종: Persian (FL-DLH-02)                               │
│  적합도: 92%                                                 │
│                                                              │
│  추천 이유:                                                   │
│  "조용하고 독립적인 성격으로 바쁜 직장인에게 적합합니다.        │
│   아파트에서도 잘 적응하며, 월 관리 비용이 예산 범위 내입니다." │
│                                                              │
│  게임 인사이트:                                               │
│  "게임에서 행복도를 우선시하는 모습을 보였습니다.               │
│   애정 표현이 풍부한 Persian이 만족도를 높여줄 것입니다."       │
└──────────────────────────────────────────────────────────────┘
```

---

## 기술 스택

| 구분 | 기술 |
|------|------|
| Backend | Spring MVC, Stripes Framework |
| Database | HSQLDB (인메모리), MyBatis |
| AI - 로컬 | Ollama llama3.1:8b (Function Calling) |
| AI - 클라우드 | Google Gemini API |
| Frontend | JSP, JavaScript (AJAX) |
| 빌드 | Maven |
| 배포 | Tomcat 9, ngrok (외부 접속) |

---

## 주요 파일 구조

```
src/main/java/org/mybatis/jpetstore/
├── service/
│   ├── OllamaRecommendationService.java   # 초기 추천 (Function Calling)
│   ├── GameSimulationService.java         # 게임 시뮬레이션
│   ├── FinalRecommendationService.java    # 최종 추천
│   ├── OllamaClient.java                  # Ollama API 클라이언트
│   ├── GeminiClient.java                  # Gemini API 클라이언트
│   ├── AgentToolRegistry.java             # Function Calling 도구 정의
│   └── GamePromptBuilder.java             # 게임 프롬프트 생성
│
├── web/actions/
│   ├── InitialRecommendationActionBean.java
│   ├── GameSimulationActionBean.java
│   └── FinalRecommendationActionBean.java
│
└── domain/
    ├── recommendation/
    │   ├── CategoryRecommendation.java
    │   └── FinalRecommendation.java
    ├── gamesimulation/
    │   ├── GameSession.java
    │   ├── GameStateView.java
    │   └── GameOption.java
    └── agent/
        ├── Tool.java
        ├── ToolCall.java
        └── FunctionCall.java
```

---

## 특징 및 장점

1. **실시간 DB 연동**: LLM이 Function Calling으로 실제 DB 데이터 조회
2. **로컬 LLM 활용**: 민감한 데이터를 외부로 보내지 않음
3. **게임 기반 분석**: 단순 설문이 아닌 행동 패턴으로 사용자 성향 파악
4. **실시간 로그**: 처리 과정을 사용자가 실시간으로 확인 가능
5. **하이브리드 AI**: 로컬 LLM + 클라우드 API 조합으로 비용 최적화

---

## 데모 URL

- 로컬: http://localhost:8080/jpetstore
- 외부: ngrok으로 생성된 URL + /jpetstore
